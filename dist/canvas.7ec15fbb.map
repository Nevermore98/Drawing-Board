{"version":3,"sources":["canvas.js"],"names":["canvas","document","getElementById","ctx","getContext","colorBtn","getElementsByClassName","colorGroup","highlighter","eraser","width","documentElement","clientWidth","height","clientHeight","lineColor","lineWidth","isDrawing","isErasing","points","beginPoint","createHDCanvas","setCanvasBg","selectColor","onclick","isTouchDevice","ontouchstart","e","firstDot","getImageData","saveData","beginPath","x","touches","clientX","y","clientY","push","drawCircle","ontouchmove","length","lastTwoPoints","slice","controlPoint","endPoint","drawSmoothLine","onmousedown","onmousemove","onmouseup","onmouseleave","radius","save","fillStyle","strokeStyle","arc","Math","PI","fill","closePath","clip","clearRect","restore","globalCompositeOperation","moveTo","quadraticCurveTo","stroke","lineCap","lineJoin","color","fillRect","i","classList","remove","add","style","backgroundColor","w","h","ratio","window","devicePixelRatio","scale"],"mappings":"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","file":"canvas.7ec15fbb.map","sourceRoot":"../src","sourcesContent":["const canvas = document.getElementById('drawing-board')\nconst ctx = canvas.getContext('2d')\nconst colorBtn = document.getElementsByClassName('color-item')\nconst colorGroup = document.getElementsByClassName('color-group')\n\nconst highlighter = document.getElementById('highlighter')\nconst eraser = document.getElementById('eraser')\n\ncanvas.width = document.documentElement.clientWidth\ncanvas.height = document.documentElement.clientHeight\n\nlet lineColor = 'black'\nlet lineWidth = 4\n\nlet isDrawing = false\nlet isErasing = false\n\n// 存储坐标点\nlet points = []\nlet beginPoint = null\n\n// 创建高清画布\ncreateHDCanvas()\n// 设置背景颜色，下载的图片背景才有颜色\nsetCanvasBg('white')\n// 选择线条颜色\nselectColor()\n\nhighlighter.onclick = () => {\n  isErasing = false\n}\n\neraser.onclick = () => {\n  isErasing = true\n}\n\n// 绘图\n// 判断是否为触屏设备\nlet isTouchDevice = 'ontouchstart' in document.documentElement\nif (isTouchDevice) {\n  // 触屏设备\n  canvas.ontouchstart = (e) => {\n    //储存绘图表面\n    this.firstDot = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    saveData(this.firstDot)\n    isDrawing = true\n    ctx.beginPath()\n    beginPoint = {x: e.touches[0].clientX, y: e.touches[0].clientY}\n    points.push({x: e.touches[0].clientX, y: e.touches[0].clientY})\n    drawCircle(beginPoint.x, beginPoint.y, lineWidth / 2)\n  }\n  canvas.ontouchmove = (e) => {\n    if (!isDrawing) return\n    ctx.beginPath()\n    points.push({x: e.touches[0].clientX, y: e.touches[0].clientY})\n\n    if (points.length > 3) {\n      const lastTwoPoints = points.slice(-2)\n      const controlPoint = lastTwoPoints[0]\n      const endPoint = {\n        x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,\n        y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2,\n      }\n      drawSmoothLine(beginPoint, controlPoint, endPoint)\n      beginPoint = endPoint\n    }\n  }\n} else {\n  // 非触屏设备\n  canvas.onmousedown = (e) => {\n    //储存绘图表面\n    this.firstDot = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    saveData(this.firstDot)\n    isDrawing = true\n    ctx.beginPath()\n    beginPoint = {x: e.clientX, y: e.clientY}\n    points.push({x: e.clientX, y: e.clientY})\n    drawCircle(beginPoint.x, beginPoint.y, lineWidth / 2)\n  }\n\n  canvas.onmousemove = (e) => {\n    if (!isDrawing) return\n    ctx.beginPath()\n    points.push({x: e.clientX, y: e.clientY})\n\n    if (points.length > 3) {\n      const lastTwoPoints = points.slice(-2)\n      const controlPoint = lastTwoPoints[0]\n      const endPoint = {\n        x: (lastTwoPoints[0].x + lastTwoPoints[1].x) / 2,\n        y: (lastTwoPoints[0].y + lastTwoPoints[1].y) / 2,\n      }\n      drawSmoothLine(beginPoint, controlPoint, endPoint)\n      beginPoint = endPoint\n    }\n  }\n\n  canvas.onmouseup = (e) => {\n    if (!isDrawing) return\n    ctx.beginPath()\n    points.push({x: e.clientX, y: e.clientY})\n\n    if (points.length > 3) {\n      const lastTwoPoints = points.slice(-2)\n      const controlPoint = lastTwoPoints[0]\n      const endPoint = lastTwoPoints[1]\n      drawSmoothLine(beginPoint, controlPoint, endPoint)\n    }\n    beginPoint = null\n    isDrawing = false\n    points = []\n  }\n\n  canvas.onmouseleave = () => {\n    isDrawing = false\n  }\n}\n\n// 画圆形\nfunction drawCircle(x, y, radius) {\n  if (isErasing) {\n    ctx.save()\n    ctx.fillStyle = 'white'\n    ctx.strokeStyle = 'white'\n    ctx.arc(x, y, radius, 0, Math.PI * 2)\n    ctx.fill()\n    ctx.closePath()\n    ctx.clip()\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.restore()\n  } else {\n    ctx.beginPath()\n    ctx.fillStyle = lineColor\n    ctx.arc(x, y, radius, 0, Math.PI * 2)\n    ctx.fill()\n    ctx.closePath()\n  }\n}\n\n// 绘制二次贝塞尔平滑曲线\nfunction drawSmoothLine(beginPoint, controlPoint, endPoint) {\n  ctx.lineWidth = lineWidth\n  if (isErasing) {\n    ctx.save()\n    ctx.globalCompositeOperation = \"destination-out\"\n    ctx.moveTo(beginPoint.x, beginPoint.y)\n    ctx.quadraticCurveTo(controlPoint.x, controlPoint.y, endPoint.x, endPoint.y)\n    ctx.stroke()\n    ctx.closePath()\n    ctx.clip()\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.restore()\n  } else {\n    ctx.beginPath()\n    ctx.lineCap = 'round'\n    ctx.lineJoin = 'round'\n    ctx.moveTo(beginPoint.x, beginPoint.y)\n    ctx.quadraticCurveTo(controlPoint.x, controlPoint.y, endPoint.x, endPoint.y)\n    ctx.stroke()\n    ctx.closePath()\n  }\n}\n\nfunction setCanvasBg(color) {\n  ctx.fillStyle = color\n  ctx.fillRect(0, 0, canvas.width, canvas.height)\n  ctx.fillStyle = 'white'\n}\n\nfunction selectColor() {\n  ctx.beginPath()\n  for (let i = 0; i < colorBtn.length; i++) {\n    colorBtn[i].onclick = function () {\n      for (let i = 0; i < colorBtn.length; i++) {\n        colorBtn[i].classList.remove('active')\n        this.classList.add('active')\n        lineColor = this.style.backgroundColor\n        ctx.strokeStyle = lineColor\n      }\n    }\n  }\n}\n\nfunction createHDCanvas(w = canvas.width, h = canvas.height) {\n  let ratio = window.devicePixelRatio || 1\n  canvas.width = w * ratio // 实际渲染像素\n  canvas.height = h * ratio // 实际渲染像素\n  canvas.style.width = `${w}px` // 控制显示大小\n  canvas.style.height = `${h}px` // 控制显示大小\n  ctx.scale(ratio, ratio)\n  return canvas\n}\n"]}